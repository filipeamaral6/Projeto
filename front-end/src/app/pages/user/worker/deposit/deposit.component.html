<div class="row col-md-10" style="padding-left: 15px;">
  <div class="card col-md-4" style="margin-right: 15px;">
    <input
      type="text"
      class="form-control"
      name="searchString"
      placeholder="Pesquisar por cartão de cidadão..."
      [(ngModel)]="searchString"
      style="border-width: 0; padding: 15px;"
    />
  </div>
  <div class="card col-md-2">
    <select
      class="form-control"
      value="ALL"
      name="status"
      #f
      (change)="fetchClients()"
      style="border-width: 0px; margin: auto;"
    >
      <ng-container *ngFor="let status of statusArray">
        <option [value]="status">{{ status }}</option>
      </ng-container>
    </select>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <div class="table-responsive">
      <h5>Selecionar Cliente</h5>
      <table class="table">
        <thead class=" text-primary">
          <tr>
            <th>
              Nome
            </th>

            <th>
              Morada
            </th>
            <th>
              Cartão de Cidadão
            </th>
            <th class="text-right">
              Estado
            </th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let client of clients | filter: 'clientCc':searchString"
            (click)="openModal(depositModal, client)"
          >
            <td>
              {{ client.fullName }}
            </td>
            <td>
              {{ client.address }}
            </td>
            <td>
              {{ client.clientCc }}
            </td>
            <td class="text-right">
              {{ client.status }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<ng-template #depositModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">
      Selecionar conta e valor do depósito
    </h4>
    <button
      type="button"
      class="close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click'); activeModal = false"
    >
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form #form="ngForm">
      <div class="row col-md-8">
        <div class="form-group">
          <label for="selectAccount">Selecionar conta</label>
          <select
            name="account"
            class="form-control"
            [(ngModel)]="selectedAccount"
            [ngClass]="{ 'is-invalid': account.touched && account.errors }"
            #account="ngModel"
            required
          >
            <option *ngFor="let account of accounts" [ngValue]="account"
              >Número: {{ account.accountNumber }} | IBAN:
              {{ account.iban }}</option
            >
          </select>
          <div
            *ngIf="account.touched && account.hasError('required')"
            class="invalid-feedback"
          >
            Selecione uma conta!
          </div>
        </div>
      </div>
      <hr />
      <div class="row col-md-12">
        <div class="form-group" style="padding-right: 4.9%">
          <label for="depositerName">Nome do depositante*</label>
          <input
            type="text"
            class="form-control"
            name="depositerName"
            [(ngModel)]="deposit.depositerName"
            [ngClass]="{
              'is-invalid': depositerName.touched && depositerName.errors
            }"
            #depositerName="ngModel"
            required
          />
          <div
            *ngIf="depositerName.touched && depositerName.hasError('required')"
            class="invalid-feedback"
          >
            Insira o nome do depositante!
          </div>
        </div>
        <div class="form-group">
          <label for="depositerCcNumber">Número de CC do depositante*</label>
          <input
            type="text"
            class="form-control"
            name="depositerCcNumber"
            [(ngModel)]="deposit.depositerCcNumber"
            [ngClass]="{
              'is-invalid':
                depositerCcNumber.touched && depositerCcNumber.errors
            }"
            #depositerCcNumber="ngModel"
            required
          />
          <div
            *ngIf="
              depositerCcNumber.touched &&
              depositerCcNumber.hasError('required')
            "
            class="invalid-feedback"
          >
            Insira o CC do depositante!
          </div>
        </div>
      </div>
      <div class="form-group" style="padding-right: 4.9%">
        <label for="description">Descrição*</label>
        <textarea
          type="text"
          class="form-control"
          name="description"
          [(ngModel)]="deposit.description"
          [ngClass]="{
            'is-invalid': description.touched && description.errors
          }"
          #description="ngModel"
          required
        ></textarea>
        <div
          *ngIf="description.touched && description.hasError('required')"
          class="invalid-feedback"
        >
          Insira uma descrição!
        </div>
      </div>
      <hr />
      <div class="row col-md-8" style="align-content: center">
        <div class="form-group" style="padding-right: 4.9%">
          <label for="amount">Quantia a depositar(€)*</label>
          <input
            type="number"
            class="form-control"
            name="amount"
            [(ngModel)]="deposit.value"
            [ngClass]="{ 'is-invalid': amount.touched && amount.errors }"
            #amount="ngModel"
            required
            [min]="5"
          />
          <div
            *ngIf="amount.touched && amount.hasError('required')"
            class="invalid-feedback"
          >
            Insira uma quantia a depositar!
          </div>
          <div
            *ngIf="amount.touched && amount.hasError('min')"
            class="invalid-feedback"
          >
            A quantia tem de ser igual ou superior a 5€!
          </div>
        </div>
      </div>
      <button
        type="submit"
        class="btn btn-success"
        (click)="depositIntoAccount(form)"
        [disabled]="form.invalid"
      >
        Depositar
      </button>
    </form>
  </div>
</ng-template>
